<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<!-- Link dependencies -->
<link rel="import" href="./comma-separated-values.html">
<dom-module id="bio-data-csv">
    <template>
        <style>
        :host {
            display: block;
        }
        </style>
    <!-- ajax call to our csv file -->
    <iron-ajax
       auto
       url="{{csvUrl}}"
       handle-as="text"
       last-response="{{csvData}}"></iron-ajax>
    <div>{{computeJSON(csvData)}}</div>
    </template>
    <script>
    (function() {
        'use strict';

        Polymer({
            is: 'bio-data-csv',

            properties: {
                jsonData: {
                  type: Object,
                  value: '',
                  notify: true
                },
                csvUrl: {
                  type: String,
                  value: "../../data/Cells.csv",
                  notify: true
                },
                csvData: {
                  type: String,
                  value: '',
                  notify: true
                }
            },

            // Computes JSON data when csvData is loaded
            computeJSON: function(csvData) {
              var csv = new CSV(csvData);
              this.jsonData = csv.parse();
              var values = this.jsonData.slice(); // copy data
              var header = values.shift() // removes the first element from values
              if(header != undefined && header[0] != "<!DOCTYPE") {
                this.fire('json-loaded', {header: header,values: values}); // Fire an event
              } else {
                this.fire('json-not-found', {}); 
              }
            }
        });
    })();
    </script>
</dom-module>
